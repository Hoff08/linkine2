
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Sistema Fotogr√°fico PRO X</title>
    
    <!-- √çcone para a aba do navegador (Favicon para Chrome, Firefox, etc.) -->
    <link rel="icon" type="image/png" href="logo.png">

    <!-- √çcone para a Tela de In√≠cio do iPhone/iPad -->
    <link rel="apple-touch-icon" href="logo.png">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    
    <!-- Biblioteca de Gr√°ficos Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
        :root {
            --bg-main: #0D0D0F; --bg-card: #1C1D21; --bg-highlight: #3D52D5;
            --accent-primary: #3D52D5; --accent-secondary: #34D399; --accent-red: #E74C3C; --accent-yellow: #F39C12;
            --text-primary: #FFFFFF; --text-secondary: #8A8F98; --border-color: rgba(255, 255, 255, 0.1);
            --font-family: 'Inter', system-ui, -apple-system, sans-serif;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: var(--font-family); }
        html { background-color: var(--bg-main); }
        html, body { height: 100%; overflow: hidden; }
        body { background-color: var(--bg-main); color: var(--text-primary); display: flex; justify-content: center; align-items: center; font-size: 16px; -webkit-font-smoothing: antialiased; }
        ::-webkit-scrollbar { display: none; }

        .app-container { width: 100%; height: 100%; display: flex; background-color: var(--bg-main); }
        
        .main-content { width:100%; display: flex; flex-direction: column; overflow: hidden; padding-bottom: 90px; }
        .content-area { flex-grow: 1; overflow-y: auto; }
        .content-section { display: none; padding: 24px; } 
        .content-section.active { display: block; animation: fadeIn 0.4s ease; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .section-header { display:flex; justify-content: space-between; align-items:center; margin-bottom: 24px; }
        .section-title { font-size: 1.3rem; font-weight: 600; color: var(--text-primary); }
        .add-button { background-color: var(--bg-card); color: var(--text-primary); border: none; font-weight: 600; padding: 10px 16px; border-radius: 12px; cursor: pointer; }
        .no-data-message { color: var(--text-secondary); text-align: center; padding: 20px 0;}

        .search-bar { display: flex; align-items: center; background-color: var(--bg-card); padding: 12px 16px; border-radius: 16px; margin-bottom: 24px; }
        .search-bar input { background: none; border: none; color: var(--text-primary); font-size: 1rem; flex-grow: 1; outline: none; }
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-bottom: 32px; }
        .stat-card { background-color: var(--bg-card); border-radius: 20px; padding: 20px; }
        .stat-card.highlight-card { background-color: var(--bg-highlight); grid-row: span 2; display:flex; flex-direction:column; justify-content:center; }
        .stat-card .card-header { display: flex; justify-content: space-between; align-items: center; }
        .stat-card .card-arrow { width: 32px; height: 32px; background-color: rgba(0,0,0,0.2); border-radius: 50%; display:flex; align-items:center; justify-content:center; }
        .stat-card .card-title { font-size: 0.9rem; margin-top: 16px; color: var(--text-secondary); }
        .highlight-card .card-title { color: rgba(255,255,255,0.7); }
        .stat-card .card-value { font-size: 2rem; font-weight: 700; margin-top: 4px; }
        .stock-overview { background-color: var(--bg-card); border-radius: 16px; padding: 16px; display: flex; justify-content: space-around; margin-bottom: 32px; }
        .stock-item { text-align: center; }
        .stock-item .status { display: flex; align-items: center; gap: 6px; font-size: 0.9rem; color: var(--text-secondary); justify-content: center;}
        .stock-item .status .dot { width: 10px; height: 10px; border-radius: 50%; }
        .stock-item .status .dot.green { background-color: var(--accent-secondary); }
        .stock-item .status .dot.orange { background-color: var(--accent-yellow); }
        .stock-item .status .dot.red { background-color: var(--accent-red); }
        .stock-item .value { font-size: 1.2rem; font-weight: 600; margin-top: 8px; }
        
        .list-container { background-color: var(--bg-card); border-radius: 16px; padding: 8px 20px; }
        .list-item { display: flex; align-items: center; padding: 16px 0; border-bottom: 1px solid var(--border-color); }
        .list-item:last-child { border: none; }
        .list-item-avatar { width: 40px; height: 40px; border-radius: 50%; background: var(--bg-main); display:flex; align-items:center; justify-content:center; margin-right: 16px; font-weight: 600; text-transform: uppercase; }
        .list-item-details { flex-grow: 1; }
        .list-item-title { font-weight: 600; }
        .list-item-subtitle { font-size: 0.8rem; color: var(--text-secondary); }
        .delete-btn { background: none; border: none; color: var(--text-secondary); cursor: pointer; opacity: 0.5; transition: all 0.2s; padding: 5px; }
        .delete-btn:hover { opacity: 1; color: var(--accent-red); transform: scale(1.1); }
        .side-text-revenue { color: var(--accent-secondary); } .side-text-expense { color: var(--text-primary); }
        .list-item-side-text { font-weight: 700; font-size: 1rem; margin-left:10px; }

        .modal { display: none; position: fixed; z-index: 1000; left: 0; top: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.7); justify-content: center; align-items: flex-end; }
        .modal-content { background: #1C1D21; padding: 24px; border-radius: 24px 24px 0 0; width: 100%; animation: slideUp 0.3s ease; max-height: 85vh; overflow-y: auto;}
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
        .modal-content h2 { margin-bottom: 24px; font-size: 1.5rem; text-align: center; }
        .form-group { margin-bottom: 16px; }
        .form-group label { display: block; margin-bottom: 8px; font-size: 0.9em; color: var(--text-secondary); }
        .form-group input, .form-group select, .form-group textarea { width: 100%; background-color: var(--bg-main); border: 1px solid var(--border-color); border-radius: 12px; padding: 14px; color: var(--text-primary); font-size: 1em; }
        .modal-content button[type="submit"] { width: 100%; background: var(--accent-primary); color: #fff; border: none; padding: 14px; font-size: 1em; font-weight: 600; border-radius: 12px; cursor: pointer; margin-top: 10px; }
        .close-modal-btn { position: absolute; top: 20px; right: 20px; font-size: 28px; cursor: pointer; color: var(--text-secondary); }
        #more-menu-list a { display: block; padding: 15px; font-size: 1.1em; color: var(--text-primary); text-decoration: none; border-bottom: 1px solid var(--border-color); }
        #more-menu-list a:last-child { border: none; }

        .bottom-tab-bar { display: flex; align-items: center; justify-content: space-around; position: fixed; bottom: 24px; left: 24px; right: 24px; height: 64px; background: #202124; border-radius: 100px; z-index: 100; padding: 0 20px; border: 1px solid #333; }
        .tab-item { background: none; border: none; color: var(--text-secondary); cursor: pointer; transition: color 0.2s; height: 100%; display: flex; align-items: center; justify-content: center; flex-grow: 1; }
        .tab-item.active { color: var(--text-primary); }
        .tab-item svg { width: 26px; height: 26px; pointer-events: none; }
        
        .status-badge { padding: 4px 10px; border-radius: 12px; font-size: 0.8em; font-weight: 600; text-transform: capitalize; background-color: rgba(138, 143, 152, 0.2); color: #8A8F98;}
        .status-badge.status-funcional, .status-badge.status-entregue, .status-badge.status-ativo { background-color: rgba(52, 211, 153, 0.2); color: #34D399; }
        .status-badge.status-manutencao, .status-badge.status-planejado { background-color: rgba(251, 191, 36, 0.2); color: #FBBF24; }
        .status-badge.status-quebrado, .status-badge.status-cancelado, .status-badge.status-inativo { background-color: rgba(248, 113, 113, 0.2); color: #F87171; }
        .priority-alta { color: var(--accent-red); } .priority-media { color: var(--accent-yellow); } .priority-baixa { color: var(--accent-secondary); }
        .checklist-card ul { list-style: none; padding-top:10px; } .checklist-card li { display: flex; align-items: center; margin-bottom: 10px; }
        .checklist-card input[type="checkbox"] { margin-right: 12px; accent-color: var(--accent-primary); width:18px; height:18px; }
        .checklist-card label { display: flex; align-items: center; flex-grow:1; }
        .checklist-card .add-checklist-item-btn { font-size: 1.2rem; margin-left: 10px; background: none; color: var(--accent-primary); border: none; cursor: pointer; }
        .inspiration-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 16px; }
        .inspiration-card { background-color: var(--bg-card); border-radius: 18px; overflow: hidden; position: relative; }
        .inspiration-card .media-container { width: 100%; height: 150px; background-color: var(--bg-main); display: flex; align-items: center; justify-content: center; }
        .inspiration-card .media-container img, .inspiration-card .media-container iframe { width: 100%; height: 100%; object-fit: cover; border: none; }
        .inspiration-card .title { padding: 15px; font-weight: 600; }
        .inspiration-card .delete-btn { position: absolute; top: 10px; right: 10px; background: rgba(0,0,0,0.5); border-radius: 50%; width:30px; height:30px; display:flex; align-items:center; justify-content:center; }
        
        .chart-container {
            background-color: var(--bg-card);
            padding: 20px;
            border-radius: 20px;
            height: 350px; 
            margin-top: 24px;
        }
    </style>
</head>
<body>
    <div class="app-container">
        <div class="main-content">
            <main class="content-area" id="content-area">
                <div id="visao-geral-content" class="content-section"></div>
                <div id="agenda-content" class="content-section"></div>
                <div id="tarefas-content" class="content-section"></div>
                <div id="projetos-content" class="content-section"></div>
                <div id="clientes-content" class="content-section"></div>
                <div id="financeiro-content" class="content-section"></div>
                <div id="equipamentos-content" class="content-section"></div>
                <div id="checklist-content" class="content-section"></div>
                <div id="inspiracao-content" class="content-section"></div>
                <div id="relatorios-content" class="content-section"></div>
                <div id="marketing-content" class="content-section"></div>
            </main>
        </div>
        
        <nav class="bottom-tab-bar">
            <button class="tab-item active" data-section="visao-geral" title="In√≠cio"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><path d="M9 22V12h6v10"></path></svg></button>
            <button class="tab-item" data-section="agenda" title="Agenda"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" y2="6"></line><line x1="8" y1="2" y2="6"></line><line x1="3" y1="10" y2="10"></line></svg></button>
            <button class="tab-item" data-section="projetos" title="Projetos"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path></svg></button>
            <button class="tab-item" data-section="financeiro" title="Financeiro"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="1" y2="23"></line><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"></path></svg></button>
            <button class="tab-item" id="more-menu-btn" title="Mais"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></button>
        </nav>
        
        <div id="modal-container"></div>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const firebaseConfig = {
      apiKey: "AIzaSyAieln0FlVz24xAYL6F9rGxYnCTZBYX-dE",
      authDomain: "teste-fa948.firebaseapp.com",
      databaseURL: "https://teste-fa948-default-rtdb.firebaseio.com",
      projectId: "teste-fa948",
      storageBucket: "teste-fa948.firebasestorage.app",
      messagingSenderId: "1057349112179",
      appId: "1:1057349112179:web:f0fda5b041c1e9a0a43506"
    };
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    
    const getEl = (id) => document.getElementById(id);
    const modalContainer = getEl('modal-container');
    const contentArea = getEl('content-area');
    let allData = {};
    let currentSection = 'visao-geral';
    let trajectoryChartInstance = null; 

    const defaultStructure = {
        projects: [], clients: [], schedule: [], tasks: [], expenses: [], revenues: [], 
        equipment: [], checklist: { pre: [], dia: [], pos: [] }, inspirations: [], marketingPosts: []
    };

    const loadData = () => {
        database.ref('allData/').on('value', (snapshot) => {
            const data = snapshot.val();
            allData = { ...defaultStructure, ...(data || {}) };
            if (!allData.checklist || typeof allData.checklist !== 'object') allData.checklist = { pre: [], dia: [], pos: [] };
            renderPage(currentSection);
        });
    };
    const saveData = () => database.ref('allData/').set(allData);

    const formatCurrency = (value) => (typeof value === 'number' ? value : 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
    const escapeHtml = (unsafe) => unsafe ? String(unsafe).replace(/[&<>"']/g, m => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#039;' })[m]) : "";
    
    const renderPage = (sectionId) => {
        currentSection = sectionId;
        document.querySelectorAll('.content-section').forEach(s => s.classList.remove('active'));
        const sectionDiv = getEl(`${sectionId}-content`);
        if (sectionDiv) {
            sectionDiv.classList.add('active');
            if (window.templates[sectionId]) {
                sectionDiv.innerHTML = window.templates[sectionId]();
                if (window.renderFunctions[sectionId]) {
                    window.renderFunctions[sectionId]();
                }
            }
        }
        
        document.querySelectorAll('.bottom-tab-bar .tab-item').forEach(l => l.classList.remove('active'));
        const activeTab = document.querySelector(`.tab-item[data-section="${sectionId}"]`);
        if (activeTab) {
            activeTab.classList.add('active');
        } else {
            getEl('more-menu-btn').classList.add('active');
        }
    };
    
    const handleNavClick = (e) => {
        const link = e.target.closest('.tab-item');
        if (link && link.id !== 'more-menu-btn') {
             renderPage(link.dataset.section);
        }
    };
    
    const handleContentClick = (e) => {
        const deleteBtn = e.target.closest('.delete-btn');
        if (deleteBtn) {
            const { id, type, category } = deleteBtn.dataset;
            if (id && type) {
                handleDelete(parseInt(id), type, category);
            }
            return;
        }

        const addBtn = e.target.closest('.add-button');
        if (addBtn) {
            const modalType = addBtn.dataset.type;
            if (modalType) {
                openAndHandleModal(modalType);
            }
        }
    };

    const openModal = (modalHTML) => {
        modalContainer.innerHTML = modalHTML;
        const modal = modalContainer.querySelector('.modal');
        modal.style.display = 'flex';
        const closeModalFunc = () => {
            modal.style.display = 'none';
            modalContainer.innerHTML = '';
        };
        modal.onclick = (e) => { if (e.target === modal) closeModalFunc(); };
        modal.querySelector('.close-modal-btn')?.addEventListener('click', closeModalFunc);
    };

    const closeModal = () => {
        const modal = modalContainer.querySelector('.modal');
        if (modal) {
            modal.style.display = 'none';
            modalContainer.innerHTML = '';
        }
    };

    const handleFormSubmit = (e, itemType) => {
        e.preventDefault();
        const form = e.target;
        const newItem = { id: Date.now() };
        Array.from(form.elements).forEach(el => { if(el.name) newItem[el.name] = el.value; });
        if (!allData[itemType]) allData[itemType] = [];
        allData[itemType].push(newItem);
        closeModal();
        saveData();
    };

    const handleDelete = (id, itemType, category = null) => {
        if (confirm(`Tem certeza que deseja excluir este item?`)) {
            if (category && allData[itemType] && Array.isArray(allData[itemType][category])) {
                allData[itemType][category] = allData[itemType][category].filter(item => item.id != id);
            } else if (Array.isArray(allData[itemType])) {
                allData[itemType] = allData[itemType].filter(item => item.id != id);
            }
            saveData();
        }
    };
    
    const openAndHandleModal = (type) => {
        let modalHTML = '';
        let formId = '';
        let itemType = '';

        switch (type) {
            case 'agenda':
                formId = 'schedule-form'; itemType = 'schedule';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Novo Compromisso</h2><form id="${formId}"><div class="form-group"><label>Hora</label><input type="time" name="time" required></div><div class="form-group"><label>Compromisso</label><input type="text" name="task" required></div><input type="hidden" name="date" value="${new Date().toISOString().slice(0, 10)}"><button type="submit">Adicionar</button></form></div></div>`;
                break;
            case 'tarefas':
                formId = 'task-form'; itemType = 'tasks';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Nova Tarefa</h2><form id="${formId}"><div class="form-group"><label>Descri√ß√£o</label><input type="text" name="description" required></div><div class="form-group"><label>Prioridade</label><select name="priority"><option value="baixa">Baixa</option><option value="media">M√©dia</option><option value="alta">Alta</option></select></div><div class="form-group"><label>Vencimento</label><input type="date" name="dueDate" value="${new Date().toISOString().slice(0,10)}"></div><button type="submit">Adicionar</button></form></div></div>`;
                break;
            case 'projetos':
                formId = 'project-form'; itemType = 'projects';
                let clientOptions = (allData.clients || []).map(c => `<option value="${escapeHtml(c.name)}">${escapeHtml(c.name)}</option>`).join('');
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Novo Projeto</h2><form id="${formId}"><div class="form-group"><label>Nome do Projeto</label><input type="text" name="name" required></div><div class="form-group"><label>Cliente</label><select name="client" required><option value="">Selecione</option>${clientOptions}</select></div><button type="submit">Adicionar</button></form></div></div>`;
                break;
            case 'clientes':
                formId = 'client-form'; itemType = 'clients';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Novo Cliente</h2><form id="${formId}"><div class="form-group"><label>Nome</label><input type="text" name="name" required></div><div class="form-group"><label>Contato (Email/Telefone)</label><input type="text" name="contact"></div><button type="submit">Salvar</button></form></div></div>`;
                break;
            case 'revenue':
                formId = 'revenue-form'; itemType = 'revenues';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Nova Receita</h2><form id="${formId}"><div class="form-group"><label>Descri√ß√£o</label><input type="text" name="description" required></div><div class="form-group"><label>Valor</label><input type="number" step="0.01" name="amount" required></div><div class="form-group"><label>Data</label><input type="date" name="date" required value="${new Date().toISOString().slice(0,10)}"></div><button type="submit">Adicionar</button></form></div></div>`;
                break;
            case 'expense':
                formId = 'expense-form'; itemType = 'expenses';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Nova Despesa</h2><form id="${formId}"><div class="form-group"><label>Descri√ß√£o</label><input type="text" name="description" required></div><div class="form-group"><label>Valor</label><input type="number" step="0.01" name="amount" required></div><div class="form-group"><label>Data</label><input type="date" name="date" required value="${new Date().toISOString().slice(0,10)}"></div><button type="submit">Adicionar</button></form></div></div>`;
                break;
            case 'equipamentos':
                formId = 'equipment-form'; itemType = 'equipment';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Novo Equipamento</h2><form id="${formId}"><div class="form-group"><label>Item</label><input type="text" name="item" required></div><div class="form-group"><label>Modelo</label><input type="text" name="model"></div><div class="form-group"><label>Status</label><select name="status"><option value="funcional">Funcional</option><option value="manutencao">Manuten√ß√£o</option><option value="quebrado">Quebrado</option></select></div><button type="submit">Adicionar</button></form></div></div>`;
                break;
            case 'inspiracao':
                formId = 'inspiration-form';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Nova Inspira√ß√£o</h2><form id="${formId}"><div class="form-group"><label>T√≠tulo</label><input type="text" name="title" required></div><div class="form-group"><label>Link do V√≠deo (YouTube)</label><input type="text" name="videoUrl"></div><div class="form-group"><label>Ou Imagem</label><input type="file" name="imageFile" accept="image/*"></div><button type="submit">Adicionar</button></form></div></div>`;
                break;
            case 'marketing':
                formId = 'post-form'; itemType = 'marketingPosts';
                modalHTML = `<div class="modal"><div class="modal-content"><span class="close-modal-btn">&times;</span><h2>Novo Post</h2><form id="${formId}"><div class="form-group"><label>Conte√∫do</label><input type="text" name="content" required></div><div class="form-group"><label>Canal</label><select name="channel"><option>Instagram</option><option>TikTok</option><option>Blog</option></select></div><div class="form-group"><label>Status</label><select name="status"><option value="planejado">Planejado</option><option value="entregue">Entregue</option><option value="cancelado">Cancelado</option></select></div><button type="submit">Adicionar</button></form></div></div>`;
                break;
        }

        if (modalHTML) {
            openModal(modalHTML);
            const form = getEl(formId);
            if (form) {
                if (type === 'inspiracao') {
                    form.onsubmit = (e) => {
                        e.preventDefault();
                        const title = e.target.title.value;
                        const videoUrl = e.target.videoUrl.value;
                        const imageFile = e.target.imageFile.files[0];
                        if (!allData.inspirations) allData.inspirations = [];

                        if (imageFile) {
                            const reader = new FileReader();
                            reader.onloadend = () => {
                                allData.inspirations.push({ id: Date.now(), title, type: 'image', data: reader.result });
                                saveData();
                            };
                            reader.readAsDataURL(imageFile);
                        } else if (videoUrl) {
                            allData.inspirations.push({ id: Date.now(), title, type: 'video', data: videoUrl });
                            saveData();
                        }
                        closeModal();
                    };
                } else {
                    form.onsubmit = (e) => handleFormSubmit(e, itemType);
                }
            }
        }
    };

    window.templates = {};
    window.renderFunctions = {};
    
    templates['visao-geral'] = () => `<div class="search-bar"><input type="text" placeholder="Buscar..."></div><div class="stats-grid"><div class="stat-card highlight-card"><div class="card-header"><div class="card-arrow">‚Üó</div></div><div><div class="card-title">Total de Projetos</div><div class="card-value" id="summary-total-projects">0</div></div></div><div class="stat-card"><div class="card-header"><div class="card-arrow">‚Üó</div></div><div class="card-title">Pagamentos Recebidos</div><div class="card-value" id="summary-total-payment">R$ 0</div></div><div class="stat-card"><div class="card-header"><div class="card-arrow">‚Üó</div></div><div class="card-title">Clientes</div><div class="card-value" id="summary-total-clients">0</div></div></div><h2 class="section-title">Vis√£o Geral do Estoque</h2><div class="stock-overview"><div class="stock-item"><div class="status"><span class="dot green"></span> Funcional</div><div class="value" id="stock-in-stock">0</div></div><div class="stock-item"><div class="status"><span class="dot orange"></span> Manuten√ß√£o</div><div class="value" id="stock-low-stock">0</div></div><div class="stock-item"><div class="status"><span class="dot red"></span> Quebrado</div><div class="value" id="stock-out-of-stock">0</div></div></div>`;
    renderFunctions['visao-geral'] = () => {
        getEl('summary-total-projects').textContent = (allData.projects || []).length;
        const totalRevenue = (allData.revenues || []).reduce((sum, r) => sum + parseFloat(r.amount || 0), 0);
        getEl('summary-total-payment').textContent = formatCurrency(totalRevenue);
        getEl('summary-total-clients').textContent = (allData.clients || []).length;
        getEl('stock-in-stock').textContent = (allData.equipment || []).filter(e => e.status === 'funcional').length;
        getEl('stock-low-stock').textContent = (allData.equipment || []).filter(e => e.status === 'manutencao').length;
        getEl('stock-out-of-stock').textContent = (allData.equipment || []).filter(e => e.status === 'quebrado').length;
    };

    templates.agenda = () => `<div class="section-header"><h2 class="section-title">Agenda de Hoje</h2><button class="add-button" data-type="agenda">Adicionar</button></div><div id="agenda-list" class="list-container"></div>`;
    renderFunctions.agenda = () => {
        const list = getEl('agenda-list'); list.innerHTML = '';
        const todaySchedule = (allData.schedule || []).filter(s => s.date === new Date().toISOString().slice(0, 10)).sort((a,b) => a.time.localeCompare(b.time));
        if (todaySchedule.length === 0) { list.innerHTML = `<p class="no-data-message">Nenhum compromisso para hoje.</p>`; return; }
        todaySchedule.forEach(s => {
            const item = document.createElement('div'); item.className = 'list-item';
            item.innerHTML = `<div class="list-item-avatar">${s.time}</div><div class="list-item-details"><div class="list-item-title">${escapeHtml(s.task)}</div></div><button class="delete-btn" data-id="${s.id}" data-type="schedule">üóëÔ∏è</button>`;
            list.appendChild(item);
        });
    };

    templates.tarefas = () => `<div class="section-header"><h2 class="section-title">Tarefas</h2><button class="add-button" data-type="tarefas">Adicionar</button></div><div class="list-container" id="task-list"></div>`;
    renderFunctions.tarefas = () => {
        const list = getEl('task-list'); list.innerHTML = '';
        const tasks = allData.tasks || [];
        if (tasks.length === 0) { list.innerHTML = `<p class="no-data-message">Nenhuma tarefa pendente.</p>`; return; }
        tasks.forEach(t => {
            const item = document.createElement('div'); item.className = 'list-item';
            item.innerHTML = `<div class="list-item-details"><div class="list-item-title">${escapeHtml(t.description)}</div><div class="list-item-subtitle">${escapeHtml(t.dueDate)}</div></div><div class="list-item-side-text priority-${t.priority}">${escapeHtml(t.priority)}</div><button class="delete-btn" data-id="${t.id}" data-type="tasks">üóëÔ∏è</button>`;
            list.appendChild(item);
        });
    };
    
    templates.projetos = () => `<div class="section-header"><h2 class="section-title">Projetos</h2><button class="add-button" data-type="projetos">Adicionar</button></div><div id="project-list"></div>`;
    renderFunctions.projetos = () => {
        const container = getEl('project-list'); container.innerHTML = '';
        const projects = allData.projects || [];
        if (projects.length === 0) { container.innerHTML = `<div class="list-container"><p class="no-data-message">Nenhum projeto cadastrado.</p></div>`; return; }
        projects.forEach(p => {
            const card = document.createElement('div'); card.className = 'list-item list-container'; card.style.marginBottom = '12px';
            card.innerHTML = `<div class="list-item-details"><div class="list-item-title">${escapeHtml(p.name)}</div><div class="list-item-subtitle">${escapeHtml(p.client)}</div></div><button class="delete-btn" data-id="${p.id}" data-type="projects">üóëÔ∏è</button>`;
            container.appendChild(card);
        });
    };

    templates.clientes = () => `<div class="section-header"><h2 class="section-title">Clientes</h2><button class="add-button" data-type="clientes">Adicionar</button></div><div class="list-container" id="client-list"></div>`;
    renderFunctions.clientes = () => {
        const list = getEl('client-list'); list.innerHTML = '';
        const clients = allData.clients || [];
        if (clients.length === 0) { list.innerHTML = `<p class="no-data-message">Nenhum cliente cadastrado.</p>`; return; }
        clients.forEach(c => {
            const item = document.createElement('div'); item.className = 'list-item';
            item.innerHTML = `<div class="list-item-avatar">${c.name.charAt(0)}</div><div class="list-item-details"><div class="list-item-title">${escapeHtml(c.name)}</div><div class="list-item-subtitle">${escapeHtml(c.contact)}</div></div><button class="delete-btn" data-id="${c.id}" data-type="clients">üóëÔ∏è</button>`;
            list.appendChild(item);
        });
    };

    templates.financeiro = () => `<div class="section-header"><h2 class="section-title">Financeiro</h2><div style="display:flex; gap:10px;"><button class="add-button" data-type="revenue">Receita</button><button class="add-button" data-type="expense">Despesa</button></div></div><div class="list-container" id="transaction-list"></div>`;
    renderFunctions.financeiro = () => {
        const list = getEl('transaction-list'); list.innerHTML = '';
        const transactions = [...((allData.revenues || []).map(r => ({...r, type: 'revenue'}))), ...((allData.expenses || []).map(e => ({...e, type: 'expense'})))].sort((a,b) => new Date(b.date) - new Date(a.date));
        if (transactions.length === 0) { list.innerHTML = `<p class="no-data-message">Nenhuma transa√ß√£o registrada.</p>`; return; }
        transactions.forEach(t => {
            const item = document.createElement('div'); item.className = 'list-item';
            item.innerHTML = `<div class="list-item-avatar" style="color: ${t.type === 'revenue' ? 'var(--accent-secondary)' : 'var(--accent-red)'}">${t.type === 'revenue' ? 'R' : 'D'}</div><div class="list-item-details"><div class="list-item-title">${escapeHtml(t.description)}</div><div class="list-item-subtitle">${escapeHtml(t.date)}</div></div><div class="list-item-side-text side-text-${t.type}">${t.type === 'revenue' ? '+' : '-'} ${formatCurrency(parseFloat(t.amount))}</div>`;
            list.appendChild(item);
        });
    };

    templates.equipamentos = () => `<div class="section-header"><h2 class="section-title">Equipamentos</h2><button class="add-button" data-type="equipamentos">Adicionar</button></div><div class="list-container" id="equipment-list"></div>`;
    renderFunctions.equipamentos = () => {
        const list = getEl('equipment-list'); list.innerHTML = '';
        const equipment = allData.equipment || [];
        if (equipment.length === 0) { list.innerHTML = `<p class="no-data-message">Nenhum equipamento cadastrado.</p>`; return; }
        equipment.forEach(eq => {
            const item = document.createElement('div'); item.className = 'list-item';
            item.innerHTML = `<div class="list-item-details"><div class="list-item-title">${escapeHtml(eq.item)}</div><div class="list-item-subtitle">${escapeHtml(eq.model)}</div></div><span class="status-badge status-${eq.status}">${eq.status}</span><button class="delete-btn" data-id="${eq.id}" data-type="equipment">üóëÔ∏è</button>`;
            list.appendChild(item);
        });
    };

    templates.checklist = () => `<div class="section-header"><h2 class="section-title">Checklist</h2></div><div class="list-container checklist-card"><div class="section-header"><h3>Pr√©-Produ√ß√£o</h3><button class="add-checklist-item-btn" data-category="pre">+</button></div><ul id="checklist-pre"></ul></div><div class="list-container checklist-card" style="margin-top:24px"><div class="section-header"><h3>Dia do Job</h3><button class="add-checklist-item-btn" data-category="dia">+</button></div><ul id="checklist-dia"></ul></div><div class="list-container checklist-card" style="margin-top:24px"><div class="section-header"><h3>P√≥s-Produ√ß√£o</h3><button class="add-checklist-item-btn" data-category="pos">+</button></div><ul id="checklist-pos"></ul></div>`;
    renderFunctions.checklist = () => {
        const renderCategory = (key, elementId) => {
            const ul = getEl(elementId); ul.innerHTML = '';
            (allData.checklist[key] || []).forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<label><input type="checkbox" data-id="${item.id}" data-category="${key}" ${item.checked ? 'checked' : ''}> ${escapeHtml(item.text)}</label><button class="delete-btn" data-id="${item.id}" data-type="checklist" data-category="${key}">üóëÔ∏è</button>`;
                ul.appendChild(li);
            });
        };
        renderCategory('pre', 'checklist-pre'); renderCategory('dia', 'checklist-dia'); renderCategory('pos', 'checklist-pos');

        document.querySelectorAll('.add-checklist-item-btn').forEach(btn => btn.onclick = (e) => {
            const category = e.target.dataset.category;
            const text = prompt('Nova tarefa do checklist:');
            if (text) {
                if (!allData.checklist[category]) allData.checklist[category] = [];
                allData.checklist[category].push({ id: Date.now(), text, checked: false });
                saveData();
            }
        });
        document.querySelectorAll('.checklist-card input[type=checkbox]').forEach(box => box.onchange = (e) => {
            const { id, category } = e.target.dataset;
            const item = allData.checklist[category].find(i => i.id == id);
            if (item) { item.checked = e.target.checked; saveData(); }
        });
    };

    templates.inspiracao = () => `<div class="section-header"><h2 class="section-title">Inspira√ß√£o</h2><button class="add-button" data-type="inspiracao">Adicionar</button></div><div class="inspiration-grid" id="inspiration-grid"></div>`;
    renderFunctions.inspiracao = () => {
        const grid = getEl('inspiration-grid'); grid.innerHTML = '';
        const inspirations = allData.inspirations || [];
        if (inspirations.length === 0) { grid.innerHTML = `<p class="no-data-message" style="text-align: center; width: 100%;">Nenhuma inspira√ß√£o salva.</p>`; return; }
        inspirations.forEach(i => {
            const card = document.createElement('div'); card.className = 'inspiration-card';
            let mediaHTML = '';
            if(i.type === 'image') { mediaHTML = `<img src="${i.data}" alt="${escapeHtml(i.title)}">`; }
            else if(i.type === 'video') {
                const videoId = i.data.split('v=')[1]?.split('&')[0] || i.data.split('/').pop();
                mediaHTML = `<iframe src="https://www.youtube.com/embed/${videoId}" frameborder="0" allowfullscreen></iframe>`;
            }
            card.innerHTML = `<button class="delete-btn" data-id="${i.id}" data-type="inspirations">üóëÔ∏è</button><div class="media-container">${mediaHTML}</div><div class="title">${escapeHtml(i.title)}</div>`;
            grid.appendChild(card);
        });
    };

    templates.relatorios = () => `
        <div class="section-header"><h2 class="section-title">Relat√≥rios do M√™s</h2></div>
        <div id="reports-grid" class="stats-grid">
            <div class="stat-card">
                <div class="card-title">Lucro L√≠quido</div>
                <div class="card-value" id="report-profit">R$ 0,00</div>
            </div>
            <div class="stat-card">
                <div class="card-title">Total Receitas</div>
                <div class="card-value" id="report-revenue">R$ 0,00</div>
            </div>
            <div class="stat-card">
                <div class="card-title">Total Despesas</div>
                <div class="card-value" id="report-expense">R$ 0,00</div>
            </div>
            <div class="stat-card">
                <div class="card-title">Cliente Principal</div>
                <div class="card-value" style="font-size: 1.2rem;" id="report-top-client">N/A</div>
            </div>
        </div>
        <div class="section-header" style="margin-bottom: -10px; margin-top: 10px;"><h2 class="section-title">Trajet√≥ria de Ativos</h2></div>
        <div class="chart-container">
            <canvas id="trajectoryChart"></canvas>
        </div>
    `;
    renderFunctions.relatorios = () => {
        // --- 1. C√°lculos e preenchimento dos CARDS (Din√¢mico) ---
        const currentMonth = new Date().toISOString().slice(0, 7);
        const revenuesList = (allData.revenues || []).filter(r => r.date && r.date.startsWith(currentMonth));
        const expensesList = (allData.expenses || []).filter(e => e.date && e.date.startsWith(currentMonth));
        
        const revenueTotal = revenuesList.reduce((sum, r) => sum + parseFloat(r.amount || 0), 0);
        const expenseTotal = expensesList.reduce((sum, e) => sum + parseFloat(e.amount || 0), 0);
        const profit = revenueTotal - expenseTotal;
        
        const clientCounts = (allData.projects || []).reduce((acc, p) => { acc[p.client] = (acc[p.client] || 0) + 1; return acc; }, {});
        const topClient = Object.keys(clientCounts).sort((a, b) => clientCounts[b] - clientCounts[a])[0];

        getEl('report-profit').innerHTML = `<span style="color:${profit >= 0 ? 'var(--accent-secondary)' : 'var(--accent-red)'};">${formatCurrency(profit)}</span>`;
        getEl('report-revenue').innerHTML = `<span style="color:var(--accent-secondary);">${formatCurrency(revenueTotal)}</span>`;
        getEl('report-expense').innerHTML = formatCurrency(expenseTotal);
        getEl('report-top-client').textContent = topClient || 'N/A';

        // --- 2. L√≥gica e renderiza√ß√£o do GR√ÅFICO (Est√°tico) ---
        const chartCtx = getEl('trajectoryChart')?.getContext('2d');
        if (!chartCtx) return;

        // Dados est√°ticos para corresponder √† imagem de refer√™ncia
        const chartData = {
            labels: ['09/09', '24/09'],
            data: [10500, 11300] 
        };

        const goalValue = 13000;
        const goalData = Array(chartData.labels.length).fill(goalValue);

        if (trajectoryChartInstance) {
            trajectoryChartInstance.destroy();
        }

        const gradient = chartCtx.createLinearGradient(0, 0, 0, 300);
        gradient.addColorStop(0, 'rgba(42, 61, 55, 0.7)');
        gradient.addColorStop(1, 'rgba(42, 61, 55, 0)');

        trajectoryChartInstance = new Chart(chartCtx, {
            type: 'line',
            data: {
                labels: chartData.labels,
                datasets: [
                    {
                        label: 'Meta',
                        data: goalData,
                        borderColor: '#555',
                        borderWidth: 2,
                        borderDash: [3, 4],
                        pointRadius: 0,
                        fill: false,
                    },
                    {
                        label: 'Patrim√¥nio',
                        data: chartData.data,
                        borderColor: '#000000',
                        backgroundColor: gradient,
                        fill: true,
                        tension: 0, // Linha reta como na imagem
                        pointBackgroundColor: '#FFFFFF',
                        pointBorderColor: '#000000',
                        pointBorderWidth: 2,
                        pointHoverRadius: 7,
                        pointRadius: 5,
                        borderWidth: 2,
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        align: 'end',
                        labels: { color: '#FFFFFF', boxWidth: 20, padding: 20 }
                    }
                },
                scales: {
                    y: {
                        ticks: { 
                            color: '#FFFFFF',
                            stepSize: 500,
                            callback: function(value) { return 'R$ ' + value.toLocaleString('pt-BR', { minimumFractionDigits: 0 }); }
                        },
                        grid: { color: 'rgba(255, 255, 255, 0.15)' },
                        border: { display: false }
                    },
                    x: {
                        ticks: { color: '#FFFFFF' },
                        grid: { display: false },
                        border: { display: false }
                    }
                }
            }
        });
    };

    templates.marketing = () => `<div class="section-header"><h2 class="section-title">Marketing</h2><button class="add-button" data-type="marketing">Adicionar Post</button></div><div class="list-container" id="marketing-list"></div>`;
    renderFunctions.marketing = () => {
        const list = getEl('marketing-list'); list.innerHTML = '';
        const posts = allData.marketingPosts || [];
        if (posts.length === 0) { list.innerHTML = `<p class="no-data-message">Nenhum post planejado.</p>`; return; }
        posts.forEach(p => {
            const item = document.createElement('div'); item.className = 'list-item';
            item.innerHTML = `<div class="list-item-details"><div class="list-item-title">${escapeHtml(p.content)}</div><div class="list-item-subtitle">${escapeHtml(p.channel)}</div></div><span class="status-badge status-${p.status}">${p.status}</span><button class="delete-btn" data-id="${p.id}" data-type="marketingPosts">üóëÔ∏è</button>`;
            list.appendChild(item);
        });
    };
    
    const initializeApp = () => {
        contentArea.addEventListener('click', handleContentClick);
        document.querySelector('.bottom-tab-bar').addEventListener('click', handleNavClick);
        getEl('more-menu-btn').onclick = () => {
            const modalHTML = `<div class="modal"><div class="modal-content" style="border-radius:24px;"><span class="close-modal-btn" style="color:white;">&times;</span><div id="more-menu-list">
                <h2 style="margin-bottom:10px;">Mais Se√ß√µes</h2>
                <a href="#" data-section="tarefas">Tarefas</a>
                <a href="#" data-section="clientes">Clientes</a>
                <a href="#" data-section="equipamentos">Equipamentos</a>
                <a href="#" data-section="checklist">Checklist</a>
                <a href="#" data-section="inspiracao">Inspira√ß√£o</a>
                <a href="#" data-section="marketing">Marketing</a>
                <a href="#" data-section="relatorios">Relat√≥rios</a>
            </div></div></div>`;
            openModal(modalHTML);
            getEl('more-menu-list').onclick = (e) => {
                e.preventDefault();
                const link = e.target.closest('a[data-section]');
                if(link) {
                    renderPage(link.dataset.section);
                    closeModal();
                }
            };
        };
        loadData();
    };

    initializeApp();
});
</script>
</body>
</html>```
